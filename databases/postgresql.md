# PostgreSQL

- port defined in `postgresql.conf` and `pg_hba.conf` (e.g.:"C:\Program Files\PostgreSQL\17\data\postgresql.conf")

## Windows

### Install

- `choco install postgresql` ...autogenerated password --> see output
- `choco install postgresql --params '/Password:test /Port:5433' --ia '--enable-components server,commandlinetools'`
- `choco install pgadmin4`

### Check Port

Windows:

- `Get-Process -Id (Get-NetTCPConnection -LocalPort 5432).OwningProcess` ...check process to port
- `netstat -aon | findstr 5432` ...check ports
- `tasklist /fi "PID eq 7156"` ...check process to PID
- `tasklist | findstr postgres` ...check process by name

Linux:


### Setup User

[Chocolatey Software | PostgreSQL 14.4.1](https://community.chocolatey.org/packages/postgresql "â€Œ")

- If you didn't specify password during setup and didn't record the generated one, you need manually reset it using the following steps:
  - Open file `data\pg_hba.conf` in PostgreSql installation directory
  - Change `METHOD` to `trust` and restart service with `Restart-Service postgresql*`
  - Execute `"alter user postgres with password 'password';" | psql -Upostgres`
  - Revert back `data\pg_hba.conf` to METHOD `md5` or `scram-sha-256` and restart service

### Use CLI

``` shell
psql -V
psql -U postgres
psql -h <IP_Address> -p <port_no> -d <database_name> -U <DB_username> -W
```

or Linux:

```shell
sudo -u postgres psql
```

to quit:

```shell
postgres=# \q
```

Show databases, connect/disconnect to database and show tables:

```shell
postgres=# \l
postgres=# \c <dbName>
postgres=# \c postgres
postgres=# \dt
```

Show full history, show useres, run script

```shell
postgres=# \d
postgres=# \du
postgres=# \i myInsertFile.sql
```

Show table Info

```bash
psql -U postgres
\l 
\c <dbname>
SELECT table_name, column_name, data_type FROM information_schema.columns WHERE table_name='<tablename>';
```

Query on table of current connected db.

```shell
postgres=# SELECT * FROM "<tableName>";
```

Show data storage location

```shell
postgres=# show data_directory; 
```

Connect to Postgresql DOCKER Container

```shell
docker exec -it <postgres-container> /bin/sh
```

## Linux

- Install: `sudo apt install postgresql`
- Connect: `sudo -u postgres psql`
- Install PgAdmin: <https://www.pgadmin.org/download/pgadmin-4-apt/>

if problem with used port

- `sudo lsof -i :5432`
- `sudo kill <PID>`

## Queries

`EXPLAIN SELECT * FROM "Activities" WHERE "ActivityType" = 2;` explais what happens in this query

- Seq Scan: Sequential scan, meaning the database reads the entire table.
- Index Scan: If an index is used, it will show Index Scan.
- Cost: Estimated start-up and total cost of the query.
- Rows: Estimated number of rows the query will return.
- Width: Average size of the rows in bytes.
- Filter: Condition applied to the rows.

```SQL
SELECT * FROM public."Jobs"
WHERE "Identifikator" ILIKE '%olli%' 
OR "ProjectId" = '123'
ORDER BY "Id" ASC 
```

```SQL
DELETE FROM public."Jobs"
WHERE "Identifikator" ILIKE '%olli%' 
```
